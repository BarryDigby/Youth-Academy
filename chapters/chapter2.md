---
title: 'Week 2: Data Frames and Plots' 
description: Plots using ggpubr
prev: /chapter1
next: /chapter3
id: 2
type: chapter
---
<exercise id="1" title="Matrices">

In week 1 we covered vectors, which can store similar data types. In reality, it is impractical to store your datasets in a series of vectors. R uses 2 main data structures to store collections of vectors, the first of which we will cover are matrices.

Matrices are 2-dimensional data structures which contain data of the same type. Data structures >2-d are known as arrays but matrices will remain our primary focus due to their more widespread use.

The standard function in R used to create matrices is matrix() which takes as input the data required, the number of columns and the number of rows.

- The example below creates a 3x3 matrix using the numbers 1-9.

<codeblock id="02_01">
</codeblock>

- The same matrix can be generated by concatenating vectors together (each vector represents a column)

<codeblock id="02_02">
</codeblock>

However, just like vectors, matrices can not handle multiple data types. See the example below, which converts our numeric inputs to characters when we print the resulting matrix:

<codeblock id="02_03">
</codeblock>

***

Matrices are generally a suboptimal way to store your data. In practice the only time (I personally) come across matrices is when a package requires a matrix as input. Genomic datasets tend to be mostly numeric, luckily switching between a matrix and a dataframe is trivial.

In the next section we will cover the `data.frame` which is by far the most common data structure you will encounter in data science. They are ubiquitous across all industries! 

</exercise>


<exercise id="2" title="Data Frames">

Let's review the basics of a `data.frame`.

A `data.frame` is basically a table-like format (think excel spreadsheets) which has the following properties: 

<img src="tidy-1.png">

- Columns can each have a different type (`numeric`, `character`, `boolean`, `factor`)
- Columns are called "variables"
- Rows correspond to a single observation (ideally)
- Can be subset or filtered based on criteria

***

I will not spend time teaching you how to construct a `data.frame`, instead we will focus on reading in datasets and getting to grips with inspecting the dataset. 

Let's practice reading in a `data.frame`. I have prepared a healthcare dataset on strokes to use this week.

## Loading Dataframes
Any `.txt`, `.tsv`, `.csv` file can be read as a dataframe - the caveat here is that each row must have the same number of columns, and the columns must have the same number of rows - missing values will cause an error when attempting to load the data into R.

A `.tsv` file is a 'tab separated values' file, a `.csv` file is a 'comma separated values' file and a `.txt` text file can contain either comma or tab separated values. These 'spacing characters' are known as <span style="color:blue">delimiters</span>.

In R, we use the `read.table()` and `read.csv()` functions to read in dataframes. I will focus on using `read.table()` as it can handle `.txt`, `.tsv` and `.csv` files by specifying the delimiter used with the <span style="color:red">`sep`</span> argument, which takes `","`, or `"\t"` for commas and tabs, respectively. The <span style="color:red">header</span> argument tells R to set the first line of the file as the column names. 

Please take a moment to view the dataframe file as a raw file, you can clearly see the comma values separating each column. Character values are also surounded by double quotes. 

- View the raw file here -> [link](https://raw.githubusercontent.com/BarryDigby/Youth-Academy/master/data/stroke-data.csv)

Now take a moment to view the file as a dataframe on github (GitHub formats `.txt`, `.tsv` and `.csv` files automatically for you to make them easy to view). We aim to replicate this style of formatting in R. 

- View the file formatted as a dataframe here -> [link](https://github.com/BarryDigby/Youth-Academy/blob/master/data/stroke-data.csv)

<codeblock id="02_04">
</codeblock>

***

The dataframe has 4909 observations (rows) recorded for 12 variables (columns). Let's discuss each variable in the dataset:

- **id**: A patient identifier given by an integer value.
- **gender**: The sex of the patient.
- **age**: Age of the patient given by an integer value.
- **hypertension**: Does the patient suffer from hypertension?
- **heart_disease**: Does the patient suffer from heart disease?
- **ever_married**: Is the patient married?
- **work_type**: Sector the patient works in.
- **Residence_type**: Does the patient live in a rural or urban area?
- **avg\_glucose\_level**: Patients average glucose level.
- **bmi**: Patients body mass index.
- **smoking_status**: Is the patient one of "former", "smoker", "non-smoker", or "unknown"?
- **stroke**: Has the patient had a stroke?

***

## Accessing values 
Conceptually, a dataframe is a grid of values. We can access specific cells by slicing the dataframe. Much like vectors, we supply an index after the dataframe variable. 

The main difference is that we supply two index values, one for rows and columns separated by a comma. 

<img src="slicingDataFrames.png" width="100%">

***

Alternatively, we can call a column by its name. This is a very useful feature of dataframes and allows for human readable, logical column names.

This is done by using the dollar (`$`) symbol after the `data.frame` variable. Try it out below: 

<codeblock id="02_05">
</codeblock>

## Filtering values
Filtering dataframes is an extremely important skill required to manipulate datasets. It is vitally important that you are able to identify and remove data of poor quality (outliers, mislabelled points, non-informative data).

To filter data in R, we need to use <span style="color:blue">conditional operators</span>. Conditional operators return a boolean value (`TRUE`, `FALSE`) for the filtering threshold applied, and as such are also called <span style="color:blue">logical operators</span>.

- <span style="color:red">`<`</span> less than
- <span style="color:red">`<=`</span> less than or equal to
- <span style="color:red">`>`</span> greater than
- <span style="color:red">`>=`</span> greater than or equal to
- <span style="color:red">`==`</span> exactly equal to
- <span style="color:red">`!=`</span> not equal to
- <span style="color:red">`!x`</span> Not x
- <span style="color:red">`x | y`</span> x OR y
- <span style="color:red">`x & y`</span> x AND y

In the example below, we will filter the dataset to remove patients below the age of 18 using `subset()`, who's first argument is the dataframe to subset, followed by the variable we wish to perform a conditional operation on, and finally the operation itself. 

<codeblock id="02_06">
</codeblock>

## Updating Dataframes
It is common practice to create new columns in a dataframe that are a function of previously existing columns in the dataset. For example, in the stroke dataset, we might want to transform the variable 'avg\_glucose\_level' using the natural logarithm, storing it as a new variable:

```R
df$log_glucose <- log(df$avg_glucose_level + 1)
```

To assign a new column/variable in our data frame, we use the dollar sign in the same way we call a column that exists. As the column name `log_glucose` does not exist, R will create the new column for you.

You can concatenate columns, perform mathematical operations, conditional operations etc - we are essentially performing operations on a series of vectors!

To delete a column in a dataset, use `subset()` with the argument `select`. By placing a minus sign before the variable name we are essentially telling R to subtract this column from the dataframe.

```R
df <- subset(df, select=-c(column_to_drop))
```



</exercise>

<exercise id="3" title="Exploratory Data Analysis (EDA)">
<p>After loading data into R, the first thing we want to do is generate some plots of the variables in the dataset. This is a measure of quality control, we can identify serious outliers or incorrectly labelled data points via plots. Furthermore, we can get a sense of the distribution of values in our dataset. Looking at the dataframe by eye is not an option here - we have nearly 5000 values!</p>

Now is a good time to define types of variables:

- <span style="color:blue">Categorical variables</span>: are values that are not quantifiable. An example would be the year you belong to in secondary school.

- <span style="color:blue">Continuous variables</span>: are values that take on an infinite number within an interval. Continuous variables are obtained via quantifiable measurements.

- <span style="color:blue">Discrete variables</span>: are values that take on a finite number of real values. An example is the outcome of rolling a dice, where the values all lie within the set {1,2,3,4,5,6}.

## Boxplots
Boxplots are useful for visualising the distribution of variables by inspecting their quartiles. We can check if our data is tightly grouped (or spread out), if it has outliers or if the distribution is skewed. The take home message from the figure below is that the 'box' in the boxplot represents the interquartile range (25th to 75th percentile) of the data. The line within the box represents the median value in the data, the blue lines extend as far as the minimum and maximum data point. The exception to this is when a point is defined as an outlier, which will appear as a data point outside of the range of the boxplot.

<img src="boxplots.png" width="100%">

***

To make a boxplot in R, we will use `ggboxplot()`. We would typically use a boxplot when we want to compare the distribution of a continuous variable within a categorical variable. Hopefully this makes sense in the plots below, where we inspect the distribution of age within the group 'smoking_status'.

Breakdown of arguments passed to `ggboxplot`:
- first argument 'df' is the dataframe with data
- `x`: Variable to plot on x-axis (the group)
- `y`: Variable to plot on y-axis (the continuous variable)
- `palette`: Color palette
- `color`: Add different colors to each boxplot (according to smoking status).
- `ggtheme`: Add a ggplot2 theme to plot. 

<codeblock id="02_10">
</codeblock>

## Histograms
Histograms show the empirical distribution of one-dimensional data, the y-axis shows the count (or proportion [frequency]) of the observations that fall in the range shown on the x-axis. If you need a quick refresher on histograms, please take a moment to walk through the example given below:

<img src="histogram_exp.jpg" width="100%">

***
To plot a histogram in R, we will use `gghistogram()`. Histograms are useful for checking the distribution of the data, particularly to assess if it follows a normal distribution. (If it does not we  have to transform the data so we do not violate the underlying assumptions of statistical tests - this is (probably) beyond the scope of this course...)


Breakdown of arguments passed to `gghistogram`:
- first argument is the dataframe
- `x`: Variable to plot on the x-axis (continuous variable)
- `y`: Variable to plot on the y-axis (..count.. or ..density..)
- `fill`: Fill color
- `color`: Color histogram according to grouping variable. 
- `rug`: add ticks along x-axis showing where original data points fall


<codeblock id="02_09">
</codeblock>

***
## Scatterplots 
Scatterplots allow us to examine the joint distribution of two continuous variables. Like the other plots, we can color the data using a 3rd variable. Scatterpots are primarily used to assess the relationship between two variables - do they rise together? (positive correlation) or does one fall as the other rises (negative correlation).

To make a scatterplot in R, we will use `ggscatter()`. A breakdown of the arguments is given below (hopefully you notice `ggpubr` recycles the same arguments for many of its functions):

- first argument `df` is the dataframe
- `x`: Data to plot on x-axis (continuous)
- `y`: Data to plot on y-axis (continuous)
- `color`: color the points according to categorical, continuous variable
- `facet.by`: Split the plot according to a variable
- `add`: Add additional parameters to the plot (I added a regression line 'reg.line')
- `conf.int`: Include regression line confidence interval
- `add.params`: configure the parameters used in `add` (I made the 'reg.line' blue.)

<codeblock id="02_07">
</codeblock>

***

Great work making it this far! You should be able to make an attempt at the questions in the quiz for this week. 

Please do not hesistate to try making your own plots using the Stroke dataset with `ggpubr()`. The documentation for each plot are available at the following links: 

- [Histograms](https://rpkgs.datanovia.com/ggpubr/reference/gghistogram.html)
- [Scatterplots](https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html)
- [Boxplots](https://rpkgs.datanovia.com/ggpubr/reference/ggboxplot.html)

The code block below is an empty slate with the dataframe and library loaded to produce plots. If you are still not comfortable, go back to the examples and make a small change to the code, click Run, and see what happens. Rinse and repeat until you are comfortable. 

If you are still struggling, not to worry. I can help you during Saturday's class. 

<codeblock id="02_06">
</codeblock>

</exercise>

<exercise id="4" title="Worksheet">

## ToothGrowth Data
For this weeks worksheet you will be inspecting the `ToothGrowth` dataset which shows the relationship between the growth of teeth of guinea pigs at each of three dose levels of Vitamin C (0.5, 1 and 2 mg) with each of two delivery methods(orange juice and ascorbic acid).

Take a moment to inspect the dataframe in the code block below. Make use of `str()`, `summary()`, `head()` etc to view the 3 variables and their data type.

<codeblock id="02_11">
</codeblock>

Answer the following questions regarding the 3 variables:

1. What type of variable is `len`?

    <choice id="1">
    <opt text="Continuous" correct=true>
    Yes that is correct, len is a measurable variable.</opt>
    <opt text="Categorical">
    Not quite. len does not denote a membership to any group.</opt>
    </choice>

2. What is the interquartile range (Q1 - Q3) for `len`?

    <choice id="2">
    <opt text="1st Q: 0.500, 3rd Q: 2.000">
    Not quite, try using summary(ToothGrowth) to check.</opt>
    <opt text="OJ:30, VC:30">
    Not quite, try using summary(ToothGrowth) to check.</opt>
    <opt text="1st Q:13.07, 3rd Q:25.27" correct=true>
    Yes that is correct!</opt>
    </choice>

3. What type of variable is `supp`?

    <choice id="3">
    <opt text="Continuous">
    Not quite, for starters supp is not numeric.</opt>
    <opt text="Categorical" correct=true>
    Yes, supp is categorical, we can see it is a factor with 2 levels (one for each group).</opt>
    </choice>

4. What does VC and OJ stand for in `supp`?

    <choice id="4">
    <opt text="Vita Coco, Orange Juice">
    Not quite, be sure to read about the dataset.</opt>
    <opt text="Vitamin C, Orange Juice" correct=true>
    Yes, ascorbic acid is vitamin c..</opt>
    <opt text="Vitamin C, OJ Simpson">
    Let's hope not for the sake of the guinea pigs.</opt>
    </choice>

5. What type of variable is `dose`?

    <choice id="5">
    <opt text="Continuous">
    Not quite, 3 doses of VC were administered, dose can only belong to one of 0.5mg, 1mg or 2mg.</opt>
    <opt text="Categorical" correct=true>
    Yes, dose is categorical, despite it having a numerical representation.</opt>
    </choice>

***

## Increasing Dose of VC
Firstly, we are going to see if increasing the Vitamin C **dose** increases tooth length. We will be using `ggboxplot()` here, feel free to make the plot as visually simple or complex as you like, the important thing is that you are able to assess the relationships between variables - not make rainbows appear on screen. 

<codeblock id="02_12">
</codeblock>

***

Answer the following questions regarding the plot:

1. Does increasing VC dose increase tooth length?

    <choice id="6">
    <opt text="Yes" correct=true>
    Indeed we can see the distributions of tooth length increase according to increased dose</opt>
    <opt text="No">
    Not quite, the y-axis represents tooth length. We can see it increase steadily with increased dose (x-axis).</opt>
    </choice>

2. Are there any outliers present in the plot?

    <choice id="7">
    <opt text="Yes" correct=true>
    Correct, we can see an individual data point in dose 0.5 which represents an outlier.</opt>
    <opt text="No">
    Not quite, review the figure explaining boxplots.</opt>
    </choice>

***

## Facet by ~
Next, we want to examine tooth length at dose level 0.5mg, 1mg and 2mg in **both** OJ abnd VC supplements. You will want to keep `len` on the y-axis, change the x-axis to `supp` and finally, use `dose` in `facet.by`. We used `facet.by` in the scatterplot example to split the plot. Make an attempt to fill out the plot below. 

<codeblock id="02_13">
</codeblock>

Answer the following question: 

1. At lower doses (0.5mg , 1mg) which supplement method is more effective?

    <choice id="8">
    <opt text="Orange Juice" correct=true>
    Correct, we can see in the 0.5mg and 1mg faceted plots that OJ yields higher tooth length.</opt>
    <opt text="Vitamin C">
    Not quite.</opt>
    </choice>

***

## Prettify
Nice job identifying trends in the dataset. Now we want to present the results to your ficticious boss. He/She likes using colorful plots to help interpret the data, and properly labelled axes are a must. He/She has requested:

- Convert the column `dose` to a factor in the dataframe.
- Plot `supp` on the x-axis
- Plot `len` on the y-axis
- Facet the plot by `dose`
- Include boxplot errorbars
- Use the "lancet" palette
- Color by `supp`
- Use the theme_bw() for ggtheme
- Make the x-axis label "Ascorbic Acid Supplement"
- Make the y-axis label "Tooth Length (mm)"
- Make the plot title "Week 2 Worksheet"

<codeblock id="02_14">
</codeblock>


</exercise>